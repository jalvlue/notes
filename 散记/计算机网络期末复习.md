# ch 0 题型
1. 单选 15\*2=30
2. 填空 10\*1=10
3. 简答 5\*6=30
4. 计算 3\*10=30


4- 15、18、19、20、21、24、25、26、33、37、43、44、45、47、57、64、66


补缺:
1. 分类编址网络地址
2. 高速网络链路、传播速度、发送速度、
3. 以太网交换机交换表更新
4. ARP 过程发生在哪些接口之间
5. 广播地址、保留地址、本机地址、私有地址
6. ICMP 差错报文 5 种
7. IP 头部结构, IP 分组最大字节数
8. 分组交换特点
9. UDP 面向报文, TCP 面向字节流
10. Ip 数据报分片
11. 网络协议三要素、
12. 带宽是发送速率的最大值
13. 网桥自学习
14. 网桥、==以太网交换机==

有效数据率
![[Pasted image 20240115093936.png]]

码分复用计算:
![[Pasted image 20240115094548.png]]
![[Pasted image 20240115094607.png]]

![[Pasted image 20240115094716.png]]

CSMA/CD
![[Pasted image 20240115095554.png]]

ICMP 报文种类
![[Pasted image 20240115100302.png]]

RIP: 距离向量
OSPF: 链路状态
BGP: 路径向量路由选择

UDP/TCP 与应用层协议
![[Pasted image 20240115104442.png]]
![[Pasted image 20240115104505.png]]



# ch 1 概述
> 主要内容: 互联网的概念 (标准化)、组成、发展历程；电路交换的基本概念、分组交换的原理；计算机网络的分类、性能指标以及两种体系结构
> 重点掌握: TCP/IP 模型中, 数据链路层、网络层、传输层的主要作用；OSI 和 TCP/IP 中, 各协议层的数据单元名称、网络协议要素；计算机网络的性能指标，速率、时延、描述数据传输可靠性的指标；计算机网络按照作用范围进行分类，可以分为几类

### 1.1
Internet-因特网-互联网, 同一个概念, 指的是覆盖全球的, 最大最广的网络, 由许多个各种计算机网络互联而成

基本特点:
1. 连通性
2. 共享

### 1.2 互联网概述
###### 1.2.1 网络的网络
计算机网络(网络) -> 互连网(网络的网络, internet) -> 互联网(Internet)
![[Pasted image 20240113134234.png]]
网络都是这样从小到大组合而成的

`网络把许多计算机连接在一起(通过路由器之类的), 互连网把许多网络通过路由器再连接在一起`

###### 1.2.2 Internet 发展三个阶段

1. Internet 前身, 单个分组交换网 ARPANET 向互联的网络进行转变的过程, Internet 使用 TCP/IP 协议族作为通信规则, 其他私人互连网可以自由选择协议, 不一定使用 TCP/IP
2. Internet 建成了三级结构的互联网, 主干网-地区网-校园网 (企业网, 局域网)
3. 形成全球范围的多层次 ISP 结构的互联网, ISP: 互联网服务提供者, ISP 拥有 ip, 需要上网可以向 ISP 付费获得 ip. 主干 ISP-地区 ISP-本地 ISP 
![[Pasted image 20240113135303.png]]

###### 1.2.3 制定互联网的正式标准阶段:
1. 互联网草案
2. 建议标准
3. 互联网标准


### 1.3 互联网组成
1. 边缘部分, edge, 用户直接使用的, 端系统
2. 核心部分, core, 为边缘部分提供服务的, 负责转发的路由器之类
###### 1.3.1 edge
网络边缘主要是端系统, 用户主机
端系统通信方式:
1. c-s, 客户-服务器
2. P2P 对等方式
![[Pasted image 20240113135901.png]]
![[Pasted image 20240113135912.png]]

###### 1.3.2 core
网络核心负责给 edge 的大量主机提供连通性, 让每一台主机之间都可以进行通信
网络核心主要组成是路由器, 负责实现分组交换, 转发收到的分组

1. 分组交换基础-电路交换
建立连接-通话-释放连接, 这种交换方式就是电路交换
![[Pasted image 20240113141128.png]]
![[Pasted image 20240113141140.png]]
电路交换的重点就在于, 在两个用户 AB 通话时, 中间的所有交换机之间的线路都被他们占用
因此使用电路交换传送计算机数据的效率很低->计算机数据是突发式出现的, 传送数据的事件可能只有占用线路时间的很小一部分

2. 计算机数据交换方式-分组交换
分组交换使用 `存储转发技术`,
一段完整的, 需要被传递的计算机数据称为 `报文`, 分组交换会将这个 `报文`, 按照分组划分规则, 划分为多个 `分组(也称为包)`, 然后对这些分组进行独立的转发
![[Pasted image 20240113141651.png]]
![[Pasted image 20240113141849.png]]
在分组交换中, 只有分组在某两个节点之间传递时, 才会占用这个链路, 其他链路不会被占用(断续占用通信资源), 不像电路交换
![[Pasted image 20240113142317.png]]
### 1.5 计算机网络的类别
###### 1.5.1 计算机网络的定义
`计算机网络主要是由一些通用的、可编程的硬件互联而成的，可用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用`

###### 1.5.2 几种不同类别的计算机网络
按网络作用范围分类:
1. 广域网 WAN 
2. 城域网 MAN 
3. 局域网 LAN 
4. 个人区域网 PAN 

按网络的使用者分类:
1. 公用网-所有愿意按照电信公司规定的缴纳费用的人都可以使用的这种网络
2. 专用网

用来把用户接入到互联网的网络:
接入网-AN-Access Netword, 本地 ISP 提供的, 与互联网之间的桥梁

### 1.6 计算机网络的性能
###### 1.6.1 性能指标
1. 速率: 比特率, 数据率, 每秒传递的比特数-bit/s
2. 带宽: 单位时间内某信道能通过的最高数据率, 也就是最大允许速率-bit/s, 用来衡量发送速率
3. 吞吐量: 单位时间内通过某个网络的实际数据量, 是现实中对网络的一种测量-bit/s
4. 时延
5. 时延带宽积
6. 往返时间 RTT: 一来一回的用时
7. 利用率

时延:
1. 发送时延: 主机或路由器发送出数据帧用的时间
![[Pasted image 20240113143649.png]]
2. 传播时延: 电磁波在信道中传播一定距离需要的时间
![[Pasted image 20240113143723.png]]
3. 处理时延: 主机和路由器收到分组时, 要花时间处理分组首部, 计算校验和, 查找转发表等的时间
4. 排队时延: 分组进入路由器后再输入队列中排队用的时间

总时延=发送时延+传播时延+处理时延+排队时延
![[Pasted image 20240113144018.png]]

时延带宽积:
时延带宽积=传播时延\*带宽(s\*bit/s=bit)
表示的是在整各传播时延过程中, 第一个 bit 到达终点之前, 信道内正在移动的总比特数
![[Pasted image 20240113144310.png]]

利用率:
![[Pasted image 20240113144523.png]]
![[Pasted image 20240113144528.png]]


###### 1.6.2 非性能特征

### 1.7 计算机网络体系结构
###### 1.7.1 计算机体系结构的形成
###### 1.7.2 协议与划分层次
###### 1.7.3 具有五层协议的体系结构
![[Pasted image 20240113145209.png]]

1. 应用层: 数据单元为 `报文`
2. 运输层: TCP 单位为 `报文段`, UDP 单位为 `用户数据报`
3. 网络层: 数据单元为 `IP数据报, 分组, 包, 数据报`
4. 数据链路层: 数据单元为 `帧`
5. 物理层: 数据单元为 `比特, bit`

![[Pasted image 20240113145734.png]]

###### 1.7.5 TCP/IP 的体系结构
![[Pasted image 20240113150159.png]]
![[Pasted image 20240113150206.png]]
![[Pasted image 20240113150214.png]]
![[Pasted image 20240113150226.png]]


# ch 2 物理层
> 主要内容: 物理层的主要任务, 数据通信系统的模型和有关概念, 信道概念, 常用编码方式, 信噪比和香农公式, 信道复用技术, 宽带接入技术

重点掌握:
```
通信介质分为哪两类？分别有哪些什么传输介质？其特点(带宽、速率、信号衰减、误码率、抗干扰……)？

信道的几个基本概念：信道、单向通信（单工通信）、双向交替通信（半双工通信）、双向同时通信（全双工通信）；基带信号、基带调制、带通调制、带通信号。

常用编码方式有哪些？曼彻斯特编码有什么特点或优缺点？

信噪比和香农公式，信道极限容量；提高信息的传输速率的方法有哪些？以编码方法为例说明p47

理解物理层传输媒体的接口主要特性：机械特性、电气特性、规程（过程）特性、功能特性。

光纤的分类方法及主要类别？

主要复用方法有哪些？了解它们的主要技术思想。波分复用的实质是什么？

模拟信号与数字信号之间如何转换？有哪些设备或装置？
```

### 2.1 物理层基本概念
物理层主要任务就是向上屏蔽物理传输媒体和通信手段的差异(抽象), 只考虑如何传输比特流, 物理层协议称为物理层 `规程`

传输媒体的接口相关特性:
1. 机械特性
2. 电气特性
3. 功能特性
4. 过程特性

### 2.2 数据通信基础知识
###### 2.2.1 数据通信模型
![[Pasted image 20240113151647.png]]
需要注意的是 `发送器` 和 `接收器`, 他们的作用就是进行调制和解调, 让计算机的比特率转为适合传输系统的格式

格式一般有两大类:
1. 模拟信号, 连续信号
2. 数字信号, 离散信号

###### 2.2.2 信道基本概念
信道表示某一个方向传递信息的媒体, 一条通信电路包含 `一条发送信道` 和 `一条接收信道` 
1. 单向通信: 单工通信
2. 双向交替通信: 半双工通信
3. 双向同时通信: 全双工通信

计算机发出的 `基带信号`, 可能有一些低频分量, 直流分量, 不能被信道直接传输, 因此需要对信号进行 `调制`

调制方式:
1. 基带调制, 编码: 对基带信号波形变换, 使之适应信道, 数字信号->数字信号
2. 带通调制: 使用 `载波` 进行调制, 把基带信号搬到较高频段, 并转换成模拟信号, 数字信号->模拟信号
![[Pasted image 20240113152717.png]]
![[Pasted image 20240113152725.png]]
曼彻斯特编码:
优点: 具有自同步能力
缺点: 产生的信号频率不是说特别高

###### 2.2.3 信道极限容量
![[Pasted image 20240113153130.png]]
奈式准则: 宽度(带宽)为 W(Hz)的低通信道中, 码元传输的最高速率是 2W(码元/秒), 传输超过, 就可能出现严重的串扰

信噪比:
信号平均功率比噪声平均功率: S/N
![[Pasted image 20240113153639.png]]
使用 dB 做单位时, 取 10 为底的对数

香农公式: 信道的极限信息传输速率
![[Pasted image 20240113153720.png]]


### 2.3 物理层下面的传输媒体
###### 2.3.1 引导性传输媒体
1. 双绞线
2. 同轴电缆
3. 光缆

###### 2.3.2 非引导性传输媒体
![[Pasted image 20240113154657.png]]
![[Pasted image 20240113154903.png]]
无线通信误码率基本概念
1. 对于给定的调制方式和数据率, 信噪比越大, 误码率越低
2. 对于同样的信噪比, 具有更高数据率的调制技术, 误码率也更高
3. 移动用户不断移动中, 无线信道的特性会发生改变, 误码率和信噪比都可能会发生改变

### 2.4 信道复用技术
![[Pasted image 20240113155114.png]]
复用就是让一个信道被共享使用(可以是同时共享也可以不同时)
###### 2.4.1 频分复用, 时分复用, 统计时分复用
频分复用-FDM: 有 N 路信号在一共信道中传送, 使用调制的方法, 把各路信号搬到适合的频率位置, 让他们不产生相互干扰(相同时间占用不同的带宽资源)
![[Pasted image 20240113155331.png]]

时分复用-TDM: 将时间划分为一段段登场的时分复用帧, 每一路信号在一个时分复用帧内占据固定序号的时隙(不同时间占用相同的频带宽度)
![[Pasted image 20240113155612.png]]
![[Pasted image 20240113155711.png]]

统计时分复用: 使用集中器, 连接多个用户, 集中他们的数据
![[Pasted image 20240113155757.png]]

###### 2.4.2 波分复用
波分复用-WDM, 光的频分复用, 用于光纤技术
![[Pasted image 20240113155914.png]]

###### 2.4.3 码分复用
码分复用-CDM
TODO

### 2.5 数字传输系统
### 2.6 宽带接入技术
1. ADSL-使用模拟电话的用户线接入
2. HFC-光纤同轴混合网, 使用有线电视网线接入
3. FTTx-光纤到户

# ch 3 数据链路层
> 主要内容: 点对点信道的数据链路层以及 PPP 协议, 理解使用广播信道 (局域网)的数据链路层特点, 掌握使用广播信道的以太网技术, 掌握拓展以太网的方法和设备, 了解 vlan 技术, 了解各种高速以太网

重点掌握:
```
数据链路层中数据封装成帧的概念？帧的发送时间如何计算？

CRC差错校验的原理、CRC校验码的计算；

局域网的拓扑结构类型及特点(总线、星型、环型、树型、和网状型)？

扩展以太网（局域网）的主要方法、技术及设备？

以太网介质访问控制CSMA/CD（载波监听多点接入/碰撞检测）协议的主要思想、特性、要点及过程？碰撞检测的概念、有关时间的计算/确定。以太网帧的结构及各个字段的意义？

CSMA/CD帧长度（最长、最短帧长）的确定、计算。

以太网交换机交换表的建立？交换机如何将帧转发？以太网交换机如何解决环路及广播风暴问题？

虚拟局域网 VLAN (Virtual LAN)的概念、特点、应用、划分方法？

以太网交换机使用的生成树协议 STP  (Spanning Tree Protocol)，其算法的要点是什么？
```

数据链路层使用的信道主要用:
1. 点对点信道, 一对一, PPP 协议
2. 广播信道, 一对多, CSMA/CD 协议

数据链路层基本问题:
1. 封装成帧
2. 透明传输
3. 插错检测

数据链路层在局域网和广域网中都有应用, 最显著的就是在局域网中, 将数据从一个主机和该局域网出口路由器之间的传送
![[Pasted image 20240113161617.png]]
![[Pasted image 20240113161648.png]]
在不同网络的数据链路层之间传递, 使用不同的数据链路层协议

### 3.1 数据链路层的几个共同问题
###### 3.1.1 数据链路和帧
点对点信道数据链路层协议数据单元: 帧
![[Pasted image 20240113161932.png]]

###### 3.1.2 三个基本问题
1. 封装成帧
发送端在一段数据的前后分别添加首部和尾部, 构成帧
接收端在收到物理层上交的比特流, 通过识别首部和尾部截取出帧数据, 因此首部和尾部的重要作用就是进行 `帧定界`
![[Pasted image 20240113162449.png]]

每一种数据链路层协议都规定了能传送帧的数据部分长度上线: `最大传送单元, MTU`
![[Pasted image 20240113162330.png]]

2. 透明传输
![[Pasted image 20240113162745.png]]
透明传输指的是: 对于一段要传输的数据, 它看不到数据链路层有哪些妨碍传输的东西

对于上面的例子, 可以使用对特殊字符添加转义符的方法进行透明传输

3. 差错检测(比特差错检测)
比特差错: 不可靠传输过程中, 01 翻转了, 使用误码率衡量传输质量
数据链路层使用 `循环冗余检验, CRC` 进行差错检测

### 3.2 点对点协议 PPP
PPP 协议是点对点链路广泛使用的数据链路层协议
###### 3.2.1 PPP 协议的特点
用户需要通过 ISP 接入互联网, 这个通信过程就是使用 PPP 协议

PPP 协议组成:
1. 将 IP 数据报封装到串行链路的方法
2. 一个用来建立、配置和测试数据链路连接的链路控制协议 LCP,
3. 一套网络控制协议 NCP

###### 3.2.2 PPP 协议的帧格式
![[Pasted image 20240113170157.png]]
首部 4 字段, 尾部 2 字段

标志字段 `F, 0x7E`, 表示帧的开始或结束, 是 PPP 帧的定界符
地址字段 `A, 0xFF`
控制字段 `C, 0x03`
协议字段:
`0x0021` 表示信息部分是 `IP数据报`
`0xC021` 表示信息部分是 `LCP数据`
`0x8021` 表示信息部分是 `网络层的控制数据`

尾部 2 字节 FCS 是 CRC 帧检验序列

对于这些 PPP 首部和尾部字段, 定义了字节填充规则来避免误解读
![[Pasted image 20240113170734.png]]

![[Pasted image 20240113170808.png]]
![[Pasted image 20240113170815.png]]
零比特填充就是发送端接收端约定一些规则, 避免控制信息被误解读, 然后接收后再根据规则恢复成原样

###### 3.2.3 PPP 协议工作状态
![[Pasted image 20240113171102.png]]

### 3.3 使用广播信道的数据链路层
局域网广泛使用广播信道
###### 3.3.1 局域网的数据链路层
![[Pasted image 20240113171222.png]]
以太网技术在局域网中大量使用, 现在以太网几乎是局域网的同义词

在局域网中, 用户同样共享信道, 此时进行协调的方法是使用动态媒体接入控制的随机接入
![[Pasted image 20240113171521.png]]

以太网标准:
1. 逻辑链路控制层 LLC,
2. 媒体介入控制层 MAC
![[Pasted image 20240113171643.png]]

适配器: 包含了设备的硬件地址
![[Pasted image 20240113171739.png]]

###### 3.3.2 CSMA/CD 协议
总线连接中, 为了在在以太网中实现一对一通信, 需要让每台设备的适配器都拥有一个独特的地址, 发送数据帧时, 目的地址写在首部, 然后进行广播, 此时局域网内其他设备收到目的为自己就接收, 不是自己就丢弃

总线只允许同一时间内只有一台计算机发送数据, 如果同时发送则会导致碰撞
因此以太网使用 CSMA/CD, 载波监听多点接入/碰撞检测协议
来协调

`多点接入`: 总线型以太网
`载波监听`: 边监听边发送, 检测信道查看是否空闲
![[Pasted image 20240113173407.png]]
在图中, A 发送失败, 使用 2t-m 时间检测到碰撞, 如果成功, 那么在 2t 时间内检测不到碰撞
因此, 2t 是发送后重要的时间窗口, 称为 `争用期(碰撞窗口)`, 通过了争用期, 说明发送成功了

在碰撞后, 以太网使用 `截断二进制指数退避算法` 来确定碰撞后重传的时机, 也就是大家在碰撞后, 不等到信道空闲就直接重传, 而是随机等待一段 `退避时间`, 来避免连续碰撞

退避时间确定:
从集合[0, 1, ..., (2^k - 1)]中随机选一个数 r, 则退避时间就是 r\*争用期
k=min(重传次数, 10)
10 次重传后就一直使用 k=10, 不让退避时间继续增长

强化碰撞:
![[Pasted image 20240113174639.png]]

由于需要边监听边发送, 因此使用 CSMA/CD 的以太网时双向交替通信(半双工通信)


###### 3.3.3 使用集线器的星形拓扑
![[Pasted image 20240113174759.png]]
集线器特点:
1. 集线器电子器件模拟实际电缆线的工作, 让整个集线器以太网逻辑上是一个总线网, 仍然使用 CSMA/CD 协议
2. 集线器有很多端口, 就像多端口的转发器
3. 集线器在物理层工作, 简单转发比特, 不进行碰撞检测
![[Pasted image 20240113175030.png]]

###### 3.3.4 以太网信道利用率
![[Pasted image 20240113192419.png]]

###### 3.3.5 以太网的 MAC 层
局域网中, `硬件地址` 又称为 `物理地址` 或 `MAC地址`
在生成硬件的时候, `MAC地址` 被固化在适配器的 ROM 中

MAC 帧格式:
![[Pasted image 20240113193048.png]]

MAC 帧最小为 64B(46B 数据+18B 首部), 数据不满 46B 时, 自动填充

除了这些 18B 之外, 还需要 8B 的额外信息(7B 前同步码+1B 帧开始界定符), 一起放在首部中


### 3.4 拓展的以太网
###### 3.4.1 在物理层拓展以太网
![[Pasted image 20240113193628.png]]

###### 3.4.2 在数据链路层拓展以太网
使用以太网交换机进行拓展
![[Pasted image 20240113193757.png]]
自学习算法: 
![[Pasted image 20240114165203.png]]
最开始为空, 每次有接口请求转发, 
就把转发的源物理地址和接口写入转发表
以后每次有新转发, 先查找转发表, 转发表有就只转发到对应接口
没有就广播到所有接口


###### 3.4.3 虚拟局域网
使用以太网交换机, 在大的局域网内部建设虚拟局域网, 让每一个小局域网成为独立的广播域, 避免广播风暴和信息泄露
![[Pasted image 20240113194137.png]]
![[Pasted image 20240113194202.png]]

### 3.5 高速以太网

# ch 4 网络层
> 主要内容: 数据报服务和虚电路服务及其特点, 网络协议 IP, 划分子网和构造超网, ICMP 协议, 主要路由选择协议, IP 多播, VPN, NAT

重点掌握
```
TCP/IP 参考模型及其详细组成？IPv4协议族包括那几个协议？

IP数据报首部各个字段的意义？其中的片偏移字段表示本片数据在初始数据报数据区的位置，其单位是？IP数据报分片的具体实现方法；IP数据报中的TTL字段的含义是什么？

什么是IP地址？由哪两部分构成？IP地址的分类及各自特点？A、B、C、D？网络号各占多少位？广播地址有什么特点？

无分类编址CIDR的主要思路，网络前缀是什么？网络掩码概念以及其作用？如何求网络号？CIDR地址块的概念，地址块的地址范围？地址快的划分方法，CIDR的路由聚合？

ARP/RARP协议及其工作原理、过程？

理解网络层的IGP、RIP、OSPF和BGP协议的基本思想及作用（范围），他们分别使用UDP、TCP协议还是IP协议交换路由信息？BGP协议中发言人用什么连接建立BGP会话、交换路径向量？

各路由选择协议的掌握程度的要求是：RIP、OSPF和BGP依次降低，RIP要熟练掌握思想、原理、算法、路由表的建立及更新具体过程；OSPF算法原理及如何计算/确定最佳路由？

网际控制报文协议ICMP有哪5几种差错报告报文？试简述之。ping、tracert的工作原理、作用？

路由器的工作原理、功能？路由器工作在哪一层？路由器怎么转发IP报文？什么是静态路由、默认路由？他们在什么情况下起作用？

NAT工作原理机制？虚拟专用网 VPN的概念、原理及应用。

子网的概念及划分子网的基本思路（详细过程、章后练习）？子网掩码的概念、作用？如何提取子网号？同一子网内的机器能否直接通信？为什么？划分子网在什么设备上体实现？

什么是直接交付？什么是间接交付？试比较异同。
```

### 4.1 网络层的几个重要概念
###### 4.1.1 网络层提供的两种服务
1. 面向连接的通信方式-在分组交换中建立一条 `虚电路`
2. 无连接- `只向上层提供简单灵活的、无连接的、尽最大努力交付的数据报服务`
![[Pasted image 20240113194827.png]]
网络层现在通常提供数据报服务

###### 4.1.2 网络层的两个层面
1. 控制层面: 维护路由表
2. 数据层面: 转发分组
![[Pasted image 20240113194940.png]]

使用 SDN 控制维护转发表:
![[Pasted image 20240113195104.png]]

### 4.2 网络协议IP
`IP协议` 是网络层的核心
与 `IP协议` 配套使用的还有
1. `地址解析协议-ARP`
2. `网络控制报文协议-ICMP`
3. `网络组管理协议-IGMP`
![[Pasted image 20240113200015.png]]

###### 4.2.1 虚拟互联网络
![[Pasted image 20240113200103.png]]

虚拟互联网络就是逻辑互联网络, 使用相同的网络层协议 `IP`
![[Pasted image 20240113200234.png]]
这样屏蔽了内部的细节

转发过程, 直接交付和间接交付
![[Pasted image 20240113200327.png]]

###### 4.2.2 IP 地址
整个互联网就是一个单一的、抽象的网络, `IP地址` 就是分配给这个网络上每一个 `主机` 或 `路由器` 的接口, 全球范围内唯一的 `32位标识符(ipv4)`, 为了可读性, 每 8 位插入点, 并按点分十进制记法进行表示
注意是接口, 主机上有多个接口就能有多个ip
![[Pasted image 20240113200702.png]]

ip 地址分为两个字段: 网络号和主机号

分类的 IP 地址:
![[Pasted image 20240113201004.png]]
![[Pasted image 20240113201011.png]]
![[Pasted image 20240113201153.png]]
![[Pasted image 20240114211101.png]]

无分类编址 CIDR:
![[Pasted image 20240113201343.png]]

CIDR 使用斜线记法, 在斜线后表示网络前缀的位数
![[Pasted image 20240113201530.png]]

使用斜线记法适合人类, 但计算机需要一个掩码来从 ip 算出网络地址(前缀)
![[Pasted image 20240113201814.png]]
![[Pasted image 20240113202008.png]]

使用子网掩码进行子网划分
![[Pasted image 20240114211551.png]]


###### 4.2.3 IP 地址与 MAC 地址
###### 4.2.4 地址解析协议 ARP
用来根据主机的 IP, 找出它对应的 MAC 地址
通过在主机的 ARP 高速缓存中存放一个从 IP 到 MAC 地址的映射表
这个表存储本局域网内各个主机的 IP 到 MAC 地址映射

如果表中有了目的 IP-MAC 映射, 写入帧中
如果没有, 启动 ARP 获取
![[Pasted image 20240113202934.png]]
![[Pasted image 20240113202945.png]]
ARP 请求是广播, 包含本机 ip、MAC, 和目的主机的 ip
ARP 响应是单播, 包含目的主机的 ip、MAC


###### 4.2.5 IP 数据报的格式
![[Pasted image 20240113203135.png]]
定长 20B, 可选变长
![[Pasted image 20240114102237.png]]
![[Pasted image 20240113203437.png]]
![[Pasted image 20240113203448.png]]
片偏移以 8 字节为单位, 需要注意

生存时间 TTL
![[Pasted image 20240114102355.png]]
限制跳数, 防止无限兜圈

首部校验和计算:
![[Pasted image 20240113203759.png]]
把首部按 16 位划分, 然后求和取反码放在校验和中

### 4.3 IP 层转发分组的过程
###### 4.3.1 基于终点的转发
![[Pasted image 20240113204237.png]]
![[Pasted image 20240113204246.png]]
![[Pasted image 20240113204253.png]]

###### 4.3.2 最长前缀匹配
![[Pasted image 20240113204918.png]]
![[Pasted image 20240113204925.png]]
![[Pasted image 20240113204935.png]]
转发表上有多个符合时, 选匹配前缀最长的那个转发

路由器转发过程:
![[Pasted image 20240113205102.png]]

###### 4.3.3 使用二叉线索查找转发表

### 4.4 网络控制报文协议 ICMP
![[Pasted image 20240113205247.png]]
使用 ICMP 的目的是更有效地转发 IP 数据报, 提高交付成功的机会
###### 4.4.1 ICMP 报文种类
1. ICMP 差错报告
2. ICMP 询问
![[Pasted image 20240113205427.png]]

###### 4.4.2 ICMP 应用举例
ping、traceroute/tracert 命令就是应用层跳过 TCP/UDP 直接使用 ICMP

### 4.5 IPv6
![[Pasted image 20240113205819.png]]

### 4.6 互联网的路由选择协议
###### 4.6.1 有关路由选择协议的几个基本概念
分层次的路由选择
![[Pasted image 20240113211036.png]]
1. 内部网关协议 IGP: RIP 和 OSPF
2. 外部网关协议 EGP: BGP-4
![[Pasted image 20240114103024.png]]

###### 4.6.2 内部网关协议 RIP
RIP 是一种分布式的, 基于距离向量的路由选择协议
要求网络中的每一个路由器都维护从他自己到其他每一个目的网络的距离
距离也称为 `跳数`, RIP 中, 跳数最大为 15, 16 及以上则为不可达
因此 RIP 适合内部小型网络

RIP 的特点
![[Pasted image 20240114103449.png]]

距离向量算法:
![[Pasted image 20240114103723.png]]
![[Pasted image 20240114103739.png]]

RIP 坏消息传得慢, 适合小型网络

###### 4.6.3 内部网关协议 OSPF
![[Pasted image 20240114104008.png]]

###### 4.6.4 外部网关协议 BGP



###### 4.6.5 路由器的构成
![[Pasted image 20240113211726.png]]
输入端口-交换结构-输出端口

交换结构详细:
![[Pasted image 20240113211849.png]]

### 4.7 IP 多播

### 4.8 虚拟专用网 VPN 和网络地址转换 NAT
###### 4.8.1 VPN
###### 4.8.2 NAT
![[Pasted image 20240114104644.png]]


# ch 5 运输层
> 主要内容: 运输层的概念及其作用 (UDP、TCP), 可靠传输的工作原理、TCP 可靠传输的实现, TCP 的流量控制和拥塞控制方法, 掌握 TCP 的运输链接管理机制, 了解 TCP 的有限状态机

重点掌握
```
传输层协议的概念及其作用（UDP、TCP）？

TCP两种主要的流量控制方案（停止等待方案、滑动窗口机制）？TCP流量控制的概念、原理、方法及详细过程？

试述拥塞控制的一般原理；增加资源能解决拥塞吗？

试述TCP的主要特点有哪些？TCP协议中滑动窗口的概念、大小的度量、作用。端口的概念及分类；TCP连接及其套接字的概念、组成，以及各部分的作用？

TCP可靠传输的工作原理、TCP可靠传输的实现（确认和重传机制），重传时间的选择算法；

TCP拥塞控制的概念、原理、方法？TCP拥塞控制算法的4个算法，及其详细过程。

TCP报头的组成，其固定部分有哪些字段组成，各字段的作用是什么？

TCP连接的建立和释放过程。
```
### 5.1 运输层协议概述
###### 5.1.1 进程之间的通信
运输层提供的是应用进程之间的逻辑连接, 为进程之间传输数据
因此需要对主机上的 IP 数据报进行 `复用` 和 `分用`
![[Pasted image 20240114110030.png]]

###### 5.1.2 运输层的两个主要协议
1. UDP, 无连接的尽最大努力的不可靠传输
2. TCP, 面向连接的全双工的可靠传输

###### 5.1.3 运输层的端口
端口就是分配给每一个进程的一个标识, 一个端口只属于一个进程
运输层通过 IP 数据报中的端口对数据报进行 `复用` 和 `分用`
![[Pasted image 20240114110420.png]]

TCP/IP 使用 16 位的端口号, 允许有 65535 个端口
![[Pasted image 20240114110629.png]]
1. 0~1023, 熟知端口, 分配给知名应用
2. 1024~49151, 登记端口
3. 49152~635535, 客户端使用的端口, 短暂端口

### 5.2 用户数据报协议 UDP
###### 5.2.1 UDP 概述
UDP 只在 IP 的基础上增加了复用、分用和差错检测
![[Pasted image 20240114110918.png]]

###### 5.2.2 UDP 首部格式
![[Pasted image 20240114113755.png]]
UDP 的校验和与 IP 类似, 但是 IP 只检测首部, UDP 检测首部和数据
就是直接全部按 16 位加起来, 取反, 放到校验和字段中

### 5.3 传输控制协议 TCP 概述
###### 5.3.1 TCP 的特点
![[Pasted image 20240114114530.png]]
![[Pasted image 20240114114538.png]]

###### 5.3.2 TCP 的连接
TCP 的连接称为套接字, 分成两部分:
1. IP
2. 端口
![[Pasted image 20240114114801.png]]

### 5.4 可靠传输的工作原理
IP 提供尽最大努力的数据报服务, 因此 TCP 为了实现可靠传输, 需要自己增加一些措施
###### 5.4.1 停止等待协议
停止等待就是发送端发送了一个分组后, 就停下来, 等待接收方的确认分组收到信息, 然后再继续发送下一个分组
![[Pasted image 20240114115047.png]]
这里有一个要点: 超时重传的时间应该设置得比 RTT 更长

停止等待协议非常简单, 但是信道利用率非常低, 因此可以考虑使用流水线的方式, 不停等

###### 5.4.2 连续 ARQ 协议
这里使用了流水线, 不停等, 并且采用了累计确认
![[Pasted image 20240114115525.png]]

### 5.5 TCP 报文段的首部格式
TCP 报文有 20B 固定长度首部, 还有 4n 可选首部
![[Pasted image 20240114115725.png]]
需要注意的几个字段
1. 序号: TCP 传送数据是面向字节流的, 因此序号中是本段报文第一个字节在字节流中的序号
2. 确认号: 表示期望收到对方下一个报文段的第一个数据字节的序号
3. 窗口: 表示自己的接收窗口大小, 指明允许对方发送的数据量, 用来让对方设置它的发送窗口

### 5.6 TCP 可靠传输的实现
###### 5.6.1 以字节为单位的滑动窗口
滑动窗口以字节为单位, 使用累计确认

###### 5.6.2 超时重传时间的选择
TCP 使用自适应算法来确定超时重传时间
![[Pasted image 20240114124542.png]]
![[Pasted image 20240114124554.png]]
![[Pasted image 20240114143618.png]]
![[Pasted image 20240114143705.png]]
![[Pasted image 20240114143846.png]]

###### 5.6.3 选择确认 SACK
有时收到的字节流序号不连续, 需要给发送端指定缺了哪些, 这时可以使用 SACK
![[Pasted image 20240114124956.png]]

### 5.7 TCP 的流量控制
###### 5.7.1 利用滑动窗口实现流量控制
流量控制就是让发送方控制发送速率, 让接收方来得及接收
通过设置窗口字段来让发送方知道
![[Pasted image 20240114125156.png]]
![[Pasted image 20240114125202.png]]
![[Pasted image 20240114142107.png]]

###### 5.7.2 TCP 的传输效率

### 5.8 TCP 的拥塞控制
###### 5.8.1 拥塞控制的一般原理
![[Pasted image 20240114142230.png]]

拥塞控制就是防止过多的数据注入到网络中, 使得网络中的路由器和链路不过载
![[Pasted image 20240114125738.png]]

控制方法:
1. 开环控制
2. 闭环控制
![[Pasted image 20240114125843.png]]

###### 5.8.2 TCP 的拥塞控制方法
1. 慢开始
2. 拥塞避免
![[Pasted image 20240114142650.png]]

3. 快重传
![[Pasted image 20240114142855.png]]

4. 快恢复
![[Pasted image 20240114142956.png]]

![[Pasted image 20240114143330.png]]
###### 5.8.3 主动队列管理 AQM

### 5.9 TCP 的运输连接管理
###### 5.9.1 连接建立
![[Pasted image 20240114145219.png]]

不能使用两报文建立连接:
![[Pasted image 20240114145348.png]]

###### 5.9.2 连接释放
![[Pasted image 20240114145924.png]]

需要时间等待的原因:
![[Pasted image 20240114150022.png]]

保活计时器:
![[Pasted image 20240114150121.png]]


# ch 6 应用层
> 主要内容: 域名系统 DNS, 文件传输协议 FTP, 远程终端协议 TELNET, 万维网 www, 电子邮件协议 SMTP, 动态主机配置协议 DHCP, 简单网络管理协议 SNMP

重点掌握
```
DNS的作用是什么？DNS系统中域名采用什么命名法？其中顶级域名有哪些？

FTP、WWW、HTTP、HTML、URL分别表示什么？试简述之。

URL 主要由三部分组成？

FTP的工作原理、详细过程？

浏览器的工作原理？掌握通过浏览器访问网站页面的详细过程；

应用层的各种应用协议及其采用的运输层协议是什么？其理由？
```

