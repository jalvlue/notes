- map 中，key 的数据类型必须为可比较的类型，chan、map、func、array、slice 不可比较
- Map 遍历序列不确定
- Map 并发不安全

# 实现
- 算法上基于 hash 实现 key 的映射和寻址
- 在数据结构上基于桶数组实现 kv 存储

插入流程:
1. 通过哈希方法取得 key 的 hash 值；
2. hash 值对桶数组长度取模，确定其所属的桶；
3. 在桶中插入 key-value 对.

![[Pasted image 20240511180236.png]]
计算哈希值是一个常数操作, 因此理论上控制桶内 kv 数量, 在桶内寻找也是一个常数

### hash
- 可重入性: 对于相同的 key, 必然产生相同的哈希值
- 离散型: 不管两个 key 之间有何关系 (相似程度), 生成的哈希值都会均匀分布
- 冲突: 输入域远大于输出域, 因此不可避免会产生哈希值冲突

### 桶数组
map 中，会通过长度为 2 的整数次幂的桶数组进行 key-value 对的存储：

1. 每个桶固定可以存放 8 个 key-value 对；
2. 倘若超过 8 个 key-value 对打到桶数组的同一个索引当中，此时会通过创建桶链表的方式来化解这一问题.(拉链法)

![[Pasted image 20240511180620.png]]


### 动态扩容机制
只有插入会触发, 删除不会
- 等量扩容, 桶数量不变
- 增量扩容, 桶数量翻倍
![[Pasted image 20240511180727.png]]

